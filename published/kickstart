# TODO: Figure out how to bootstrap this, and enable GPG checking here
# https://github.com/projectatomic/rpm-ostree/issues/190
ostreesetup --osname=puiterwijk-trees --url=http://testtrees.uiterwijk.org/repo/ --ref=puiterwijk-trees/23/x86_64/laptop --nogpg
lang ja_JP.UTF-8 --addsupport=en_US.UTF-8
keyboard us
timezone --utc Etc/UTC
auth --enableshadow
selinux --enforcing
firewall --enabled
text
xconfig --startxonboot

# These passwords will be fixed by provisioning
rootpw --plaintext provision123
bootloader --boot-drive=sda --location=mbr --password=provision123



# Partitioning
ignoredisk --only-use=sda
zerombr
clearpart --all --drives=sda --initlabel
reqpart --add-boot
# This password will also be fixed by provisioning
part pv.01 --grow --encrypted --passphrase=provision123
volgroup puiterwijkos pv.01
logvol / --size=30000 --fstype=xfs --vgname=puiterwijkos --name=root
logvol /var/home --size=50000 --fstype=xfs --vgname=puiterwijkos --name=home

halt
install
url --url=http://dl.fedoraproject.org/pub/fedora/linux/releases/23/Everything/x86_64/os
network --activate --bootproto=dhcp --onboot=on 

%packages --excludedocs
-logwatch
-sendmail
-sendmail-cf
-prelink
%end

%post
# Workaround since anaconda doesn't understand rpmostree well
# https://bugzilla.redhat.com/show_bug.cgi?id=1290888
#sed -e "s/\/home/\/var\/home/" -i /etc/fstab
echo "tmpfs   /sysroot/tmp         tmpfs   nodev,nosuid,size=2G          0  0" >>/etc/fstab
rm -f /sysroot/tmp/ks-script-*

# Import GPG key until we figure out how to do that on setup
curl http://testtrees.uiterwijk.org/rpm_ostree_gpgkey.asc | ostree remote gpg-import puiterwijk-trees --verbose --stdin
sed -i -e "s/gpg-verify=false/gpg-verify=true/" /etc/ostree/remotes.d/puiterwijk-trees.conf
%end
